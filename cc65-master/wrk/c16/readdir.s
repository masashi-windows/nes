;
; File generated by cc65 v 2.14.0
;
	.fopt		compiler,"cc65 v 2.14.0"
	.setcpu		"6502"
	.smart		on
	.autoimport	on
	.case		on
	.debuginfo	off
	.importzp	sp, sreg, regsave, regbank
	.importzp	tmp1, tmp2, tmp3, tmp4, ptr1, ptr2, ptr3, ptr4
	.macpack	longbranch
	.import		__errno
	.import		__cbm_filetype
	.export		_readdir
	.import		__dirread
	.import		__dirread1

; ---------------------------------------------------------------
; __near__ struct dirent* __near__ __fastcall__ readdir (register __near__ struct DIR*)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_readdir: near

.segment	"BSS"

L0006:
	.res	1,$00
L0007:
	.res	1,$00
L0009:
	.res	23,$00

.segment	"CODE"

	jsr     pushax
	ldy     #$00
	ldx     #$04
	jsr     regswap2
	lda     regbank+2
	ldx     regbank+3
	jsr     pushax
	lda     regbank+1
	jsr     pusha
	lda     regbank+0
	jsr     pusha
	ldy     #$40
	jsr     subysp
	ldy     #$03
	lda     (regbank+4),y
	sta     L0009+17+1
	dey
	lda     (regbank+4),y
	sta     L0009+17
	jsr     decsp4
	lda     regbank+4
	sta     (sp),y
	iny
	lda     regbank+4+1
	sta     (sp),y
	lda     sp
	ldx     sp+1
	clc
	adc     #$04
	bcc     L0010
	inx
L0010:	ldy     #$00
	sta     (sp),y
	iny
	txa
	sta     (sp),y
	lda     #$02
	jsr     __dirread
	tax
	jeq     L0005
	jsr     decsp4
	lda     regbank+4
	ldy     #$02
	sta     (sp),y
	iny
	lda     regbank+4+1
	sta     (sp),y
	lda     #<(L0009+19)
	ldy     #$00
	sta     (sp),y
	iny
	lda     #>(L0009+19)
	sta     (sp),y
	lda     #$02
	jsr     __dirread
	tax
	jeq     L0005
	lda     #$00
	sta     regbank+0
	lda     sp
	sta     regbank+2
	lda     sp+1
	sta     regbank+2+1
L0019:	lda     regbank+0
	cmp     #$40
	bcs     L001A
	lda     regbank+4
	ldx     regbank+4+1
	jsr     pushax
	lda     regbank+2
	ldx     regbank+2+1
	jsr     __dirread1
	tax
	jeq     L0005
	inc     regbank+0
	ldy     #$00
	lda     (regbank+2),y
	beq     L001A
	inc     regbank+2
	bne     L0019
	inc     regbank+2+1
	jmp     L0019
L001A:	ldy     #$03
	lda     (regbank+4),y
	tax
	dey
	lda     (regbank+4),y
	sta     ptr1
	stx     ptr1+1
	ldx     #$00
	lda     regbank+0
	clc
	adc     #$04
	bcc     L0086
	inx
	clc
L0086:	adc     ptr1
	pha
	txa
	adc     ptr1+1
	tax
	pla
	sta     (regbank+4),y
	iny
	txa
	sta     (regbank+4),y
	ldx     #$00
	lda     (sp,x)
	cmp     #$42
	jeq     L008D
	txa
	sta     regbank+1
	sta     L0007
	sta     L0006
	lda     sp
	sta     regbank+2
	lda     sp+1
	sta     regbank+2+1
	jmp     L008C
L0087:	lda     L0006
	beq     L0042
	cmp     #$01
	beq     L0048
	cmp     #$02
	beq     L0063
	cmp     #$03
	jeq     L0070
	jmp     L008B
L0042:	lda     (regbank+2,x)
	cmp     #$22
	jne     L008B
	lda     #$01
	sta     L0006
	jmp     L008B
L0048:	ldy     #$00
	lda     (regbank+2),y
	cmp     #$22
	bne     L0089
	ldy     L0007
	txa
	sta     L0009,y
	lda     L0007
	sta     L0009+22
	lda     L0009+17
	cmp     #$03
	lda     L0009+17+1
	sbc     #$00
	bcc     L0088
	lda     #$02
	sta     L0006
	jmp     L008B
L0088:	lda     #$05
	sta     L0009+21
	lda     #<(L0009)
	ldx     #>(L0009)
	jmp     L0005
L0089:	lda     L0007
	cmp     #$10
	bcs     L008B
	lda     #<(L0009)
	ldx     #>(L0009)
	clc
	adc     L0007
	bcc     L005F
	inx
L005F:	sta     ptr1
	stx     ptr1+1
	lda     (regbank+2),y
	sta     (ptr1),y
	inc     L0007
	jmp     L008B
L0063:	lda     (regbank+2,x)
	cmp     #$20
	beq     L008B
	jsr     __cbm_filetype
	sta     L0009+21
	ldy     #$00
	lda     (regbank+2),y
	cmp     #$44
	bne     L0069
	lda     #$03
	sta     L0006
	jmp     L008B
L0069:	lda     #<(L0009)
	ldx     #>(L0009)
	jmp     L0005
L0070:	lda     (regbank+2,x)
	cmp     #$45
	beq     L0073
	cmp     #$49
	bne     L008A
	lda     #$02
	jmp     L0085
L008A:	lda     #$04
L0085:	sta     L0009+21
L0073:	lda     #<(L0009)
	ldx     #>(L0009)
	jmp     L0005
L008B:	inc     regbank+1
	inc     regbank+2
	bne     L0080
	inc     regbank+2+1
L0080:	ldx     #$00
L008C:	lda     regbank+1
	cmp     regbank+0
	jcc     L0087
	lda     #$0B
	sta     __errno
	stx     __errno+1
L008D:	txa
L0005:	pha
	stx     tmp1
	ldy     #$45
	ldx     #$05
L0084:	lda     (sp),y
	sta     regbank+0,x
	dey
	dex
	bpl     L0084
	ldx     tmp1
	pla
	ldy     #$46
	jmp     addysp

.endproc

